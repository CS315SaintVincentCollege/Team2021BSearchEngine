<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Search</title>
    <script type="text/javascript">
        function validate(thisform) {
            if ((thisform.Key1.value == "") && (thisform.Key2.value == "") && (thisform.Key3.value == "")) {
                alert("No keywords or phrases entered.  Please try again.")
                thisform.Key1.focus()
                return false
            }
            else
            {
                return true
            }
        }

        function getJsonResults() {
            let formElement = document.getElementById('SearchForm');
            let formData = new FormData(formElement);
            console.log(`full key is: ${formData.get('searchkey')}`);
            let searchKeys = formData.get('searchkey').split(' ');
            console.log(`split keys are ${searchKeys}`);
            return new Promise(async (resolve, reject)=>{
                let searchTerm =  "/?";
                for (let i = 0; i < searchKeys.length; i++) {
                    searchTerm += `term${i}=${searchKeys[i]}&`
                }
                console.log(searchTerm);
                let results = await fetch(`http://localhost:8081/api/search${searchTerm}`);
                results = await results.json();
                console.log(results);
                if (results.length != 0) {
                    console.log("json parse is valid result");
                    resolve(results);
                } else {
                    resolve([]);
                }
            }) 
        }

        async function fillOutSearchResults() {
            let data = await getJsonResults();
            console.log(data);
            // for each loop here with data

            let searchItems = document.getElementById('SearchItems');
            if (data.length != 0) {
                console.log("we have search result");
                

                searchItems.innerHTML = "";

                data.forEach(element => {
                    let row = document.createElement('li');
                    let link = document.createElement('a');
                    link.href = element[0];
                    link.innerText = element[1];
                    row.appendChild(link);
                    searchItems.appendChild(row);
                });
            } else {
                console.log("we hit the error check");
                searchItems.innerHTML = "<h3>We didnt find anything please try again ;)</h3>";
            }
            
        }

        function clearSearch() {
            document.getElementById('SearchItems').innerHTML = "";
        }
    </script>
</head>

<body>

    <h2>Search the CIS Department Web Pages</h2>

    <form id="SearchForm"> <!--  method="GET" action="http://localhost:8080/api/search"> -->

        <input type="text" id="searchkey" name="searchkey" size="36" maxlength="48" />
        <strong>Keyword or phrase</strong>

        <p>
            <button type="button" onclick="fillOutSearchResults()">Submit</button>
            <input onclick="clearSearch()" type="reset" value="Clear the form" />
        </p>
    </form>

    <div>
        <ul id="SearchItems">
        </ul>
    </div>

</body>

</html>